<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Bispo-Brito</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Finanças AI">
    <link rel="apple-touch-icon" href="icon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.21.0",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js",
    "firebase/": "https://aistudiocdn.com/firebase@^12.5.0/"
  }
}
</script>
</head>
<body>
    <div id="app-container">
        <!-- BANK STYLE HEADER -->
        <header class="header">
            <div class="header-top-row">
                <button id="menuBtn" class="icon-btn menu-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <div class="user-greeting-wrapper">
                    <div id="headerGreeting" class="greeting-text">Olá</div>
                    <div id="currentDateDisplay" class="date-text">Carregando data...</div>
                </div>
                <div class="header-actions">
                     <button id="open-ai-btn-header" class="icon-btn ai-btn" title="Atualizar / IA">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                     </button>
                </div>
            </div>

            <div class="header-balance-section">
                <span class="balance-label">Saldo disponível</span>
                <div class="balance-wrapper">
                    <span id="headerBalanceValue" class="balance-value">R$ 0,00</span>
                    <button id="toggleBalanceBtn" class="icon-btn toggle-eye">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>

            <div class="month-selector-bar">
                <button class="month-btn prev-month">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </button>
                <span id="monthDisplay" class="month-display">Mês Atual</span>
                <button class="month-btn next-month">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </div>
        </header>

        <!-- SIDEBAR -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Menu</h2>
                <button id="closeSidebarBtn" class="action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="sidebar-content">
                <div class="section">
                    <div class="section-header"><h2 class="section-title">Contas</h2></div>
                    <div id="bankAccountsList"></div>
                    <div class="accounts-total"><span>Saldo Total</span><span id="accountsTotalValue">R$ 0,00</span></div>
                    <div style="padding: 1.5rem;"><button id="add-account-btn" class="btn btn-secondary" style="width: 100%; justify-content: center;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>Adicionar Conta</button></div>
                </div>
                <div class="section">
                    <div class="section-header"><h2 class="section-title">Sincronização na Nuvem</h2></div>
                    <div class="sync-config-section">
                        <p><strong>Status:</strong> <span id="sync-status-text"></span></p>
                        <div id="user-id-container" style="display: none;"><p><strong>ID do Usuário:</strong> <code id="user-id-text"></code></p></div>
                        <p id="sync-status-info"></p>
                        <button id="sync-btn" class="sync-btn-sidebar" title="Sincronizar Agora">Sincronizar Agora</button>
                    </div>
                </div>
            </div>
        </div>

        <main id="main-content">
            <!-- HOME VIEW -->
            <div id="view-home" class="app-view active">
                <div class="info-cards-grid">
                    <!-- SEÇÃO 1: SALÁRIO E DESPESAS GERAIS -->
                    <!-- 1. Entrada de Salários -->
                    <div id="card-salary" class="summary-card card-bg-success">
                        <div class="summary-header"><div class="summary-title">Entrada de Salários</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="salaryTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total Previsto</div>
                        <div class="summary-progress-bar"><div id="salaryIncomeProgressBar" class="summary-progress-bar-inner income"></div></div>
                        <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Recebido</span>
                                 <span id="salaryIncome" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Receber</span>
                                 <span id="salaryPendingValue" class="stat-val warning">R$ 0,00</span>
                             </div>
                             <span id="salaryTotalValue" style="display:none"></span> <!-- Hidden holder for logic compatibility -->
                        </div>
                    </div>

                    <!-- 2. Despesas Fixas e Variáveis -->
                    <div id="card-expenses" class="summary-card card-bg-danger">
                        <div class="summary-header"><div class="summary-title">Despesas Fixas e Variáveis</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="expensesTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total de Contas</div>
                        <div class="summary-progress-bar"><div id="fixedVariableExpensesProgressBar" class="summary-progress-bar-inner expense"></div></div>
                         <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Pago</span>
                                 <span id="fixedVariableExpenses" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Pagar</span>
                                 <span id="expensesPendingValue" class="stat-val danger">R$ 0,00</span>
                             </div>
                             <span id="expensesTotalValue" style="display:none"></span>
                        </div>
                    </div>

                    <!-- 3. Restante do Salário -->
                    <div id="card-remainder" class="summary-card card-bg-info">
                        <div class="summary-header"><div class="summary-title">Balanço Salário</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="salaryRemainder" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Livre após contas</div>
                        <div class="summary-progress-bar"><div id="salaryRemainderProgressBar" class="summary-progress-bar-inner income"></div></div>
                    </div>

                    <!-- SEPARADOR -->
                    <div class="card-separator"></div>

                    <!-- SEÇÃO 2: MUMBUCA -->
                    <!-- 4. Entrada de Mumbuca -->
                    <div id="card-mumbuca-income" class="summary-card card-bg-success">
                        <div class="summary-header"><div class="summary-title">Entrada Mumbuca</div></div>
                        <div class="summary-main">
                             <span class="currency-symbol">R$</span>
                             <span id="mumbucaTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total Previsto</div>
                        <div class="summary-progress-bar"><div id="mumbucaIncomeProgressBar" class="summary-progress-bar-inner income"></div></div>
                        <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Recebido</span>
                                 <span id="mumbucaIncome" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Receber</span>
                                 <span id="mumbucaPendingValue" class="stat-val warning">R$ 0,00</span>
                             </div>
                             <span id="mumbucaTotalValue" style="display:none"></span>
                        </div>
                    </div>

                    <!-- 5. Gastos com Mumbuca -->
                    <div id="card-mumbuca-expenses" class="summary-card card-bg-danger">
                        <div class="summary-header"><div class="summary-title">Gastos com Mumbuca</div></div>
                        <div class="summary-main">
                             <span class="currency-symbol">R$</span>
                             <span id="mumbucaExpensesTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total de Gastos</div>
                        <div class="summary-progress-bar"><div id="mumbucaExpensesProgressBar" class="summary-progress-bar-inner expense"></div></div>
                         <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Pago</span>
                                 <span id="mumbucaExpenses" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Pagar</span>
                                 <span id="mumbucaExpensesPendingValue" class="stat-val danger">R$ 0,00</span>
                             </div>
                             <span id="mumbucaExpensesTotalValue" style="display:none"></span>
                        </div>
                    </div>

                    <!-- 6. Saldo de Mumbuca -->
                    <div id="card-mumbuca-balance" class="summary-card card-bg-info">
                        <div class="summary-header"><div class="summary-title">Balanço Mumbuca</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="mumbucaBalance" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Saldo Atual</div>
                        <div class="summary-progress-bar"><div id="mumbucaBalanceProgressBar" class="summary-progress-bar-inner income"></div></div>
                    </div>

                    <!-- SEPARADOR GERAL -->
                    <div class="general-separator"></div>

                    <!-- SEÇÃO 3: RESUMO GERAL -->
                    <div id="card-general-income" class="summary-card card-bg-success">
                        <div class="summary-header"><div class="summary-title">Total Geral Entradas</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="generalTotalIncome" class="main-amount income-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Soma de todas as entradas</div>
                    </div>

                    <div id="card-general-expenses" class="summary-card card-bg-danger">
                        <div class="summary-header"><div class="summary-title">Total Geral Saídas</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="generalTotalExpenses" class="main-amount expense-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Soma de todas as saídas</div>
                    </div>

                    <!-- CARD MÁRCIA BRITO -->
                    <div id="card-marcia-summary" class="summary-card card-bg-purple">
                        <div class="summary-header"><div class="summary-title">Repasse Márcia Brito</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="marciaTotalDisplay" class="main-amount expense-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">A Pagar / Pendente</div>
                        <div class="stats-grid" style="grid-template-columns: 1fr;">
                             <div class="stat-box">
                                 <span class="stat-label">Total da Fatura</span>
                                 <span id="marciaTotalBill" class="stat-val text-light">R$ 0,00</span>
                             </div>
                        </div>
                    </div>
                </div>

                <div id="debtSummaryContainer"></div>

                <div id="monthlyAnalysisSection" class="section">
                    <div class="section-header">
                        <h2 class="section-title">Análise do Mês</h2>
                    </div>
                    <div class="analysis-content">
                        <div class="analysis-block">
                            <h3 class="analysis-block-title">Maiores Despesas (Pagas)</h3>
                            <div id="overviewChart"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LANÇAMENTOS VIEW -->
            <div id="view-lancamentos" class="app-view">
                <div class="section-header" style="margin-bottom: 1rem; justify-content: space-between;">
                    <h2 class="section-title">Lançamentos</h2>
                    <button id="open-csv-btn" class="btn btn-secondary" style="padding: 0.5rem 0.8rem; font-size: 0.8rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        Importar CSV
                    </button>
                </div>

                <div class="segmented-control">
                    <button class="segmented-btn active" data-list="incomes">Entradas</button>
                    <button class="segmented-btn" data-list="expenses">Despesas</button>
                    <button class="segmented-btn" data-list="compras-mumbuca">Compras Mumbuca</button>
                    <button class="segmented-btn" data-list="abastecimento-mumbuca">Abastecimento</button>
                    <button class="segmented-btn" data-list="avulsos">Avulsos</button>
                </div>

                <div class="lists-container">
                    <div id="list-incomes" class="list-view" style="display: block;">
                         <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-income-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Entrada
                             </button>
                         </div>
                         <div id="incomesList" class="items-list"></div>
                    </div>
                    <div id="list-expenses" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-expense-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Despesa
                             </button>
                        </div>
                        <div id="expensesList" class="items-list"></div>
                    </div>
                    <div id="list-compras-mumbuca" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-compras-mumbuca-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Compra
                             </button>
                        </div>
                        <div id="comprasMumbucaList" class="items-list"></div>
                    </div>
                    <div id="list-abastecimento-mumbuca" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-abastecimento-mumbuca-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Abastecimento
                             </button>
                        </div>
                        <div id="abastecimentoMumbucaList" class="items-list"></div>
                    </div>
                    <div id="list-avulsos" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-avulso-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Avulso
                             </button>
                        </div>
                        <div id="avulsosList" class="items-list"></div>
                    </div>
                </div>
            </div>

            <!-- GOALS VIEW -->
            <div id="view-goals" class="app-view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Metas de Gastos</h2>
                        <button id="add-goal-btn" class="icon-btn" title="Adicionar Meta">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="goalsList" class="goals-list"></div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Metas de Economia</h2>
                        <button id="add-savings-goal-btn" class="icon-btn" title="Adicionar Meta de Poupança">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="savingsGoalsList" class="goals-list"></div>
                </div>
            </div>

        </main>

        <!-- MODALS -->
        <!-- Add Item Modal -->
        <div id="addModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="addModalTitle" class="modal-title">Adicionar Transação</h2>
                    <button class="action-btn close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <form id="addForm">
                    <div class="form-group">
                        <label class="form-label" for="description">Descrição</label>
                        <input type="text" id="description" name="description" class="form-input" required placeholder="Ex: Mercado, Aluguel">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="amount">Valor (R$)</label>
                        <input type="text" id="amount" name="amount" class="form-input" required placeholder="0,00" inputmode="decimal">
                    </div>

                    <div id="typeGroup" class="form-group">
                        <label class="form-label">Tipo de Despesa</label>
                        <div style="display: flex; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                                <input type="radio" name="type" value="fixed" checked> Fixa
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                                <input type="radio" name="type" value="variable"> Variável
                            </label>
                        </div>
                    </div>

                    <div id="categoryGroup" class="form-group">
                        <label class="form-label" for="category">Categoria</label>
                        <select id="category" name="category" class="form-select">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    
                    <div id="sourceAccountGroup" class="form-group">
                        <label class="form-label" for="sourceAccount">Conta de Saída</label>
                        <select id="sourceAccount" name="sourceAccount" class="form-select"></select>
                    </div>

                    <div id="installmentsGroup" class="form-group" style="display: none;">
                        <label class="form-label">Parcelamento</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" style="font-size: 0.75rem;">Parcela Atual</label>
                                <input type="number" name="currentInstallment" class="form-input" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label" style="font-size: 0.75rem;">Total Parcelas</label>
                                <input type="number" name="totalInstallments" class="form-input" value="1" min="1">
                            </div>
                        </div>
                        <div class="form-group-checkbox" style="margin-top: 0.5rem;">
                            <input type="checkbox" id="cyclic" name="cyclic">
                            <label for="cyclic" style="font-size: 0.85rem;">Despesa Recorrente (mensal)</label>
                        </div>
                    </div>

                    <div id="dateGroup" class="form-group">
                        <label id="transactionDateLabel" class="form-label" for="transactionDate">Data</label>
                        <input type="date" id="transactionDate" name="transactionDate" class="form-input">
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                        <button type="submit" class="btn">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- CSV Import Modal -->
        <div id="csvImportModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2 class="modal-title">Importar Extrato Bancário (CSV)</h2>
                    <button class="action-btn close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                
                <div class="file-upload-area" id="csvDropZone">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 0.5rem;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                    <h3>Selecione o arquivo CSV</h3>
                    <p>Clique aqui para buscar o arquivo do seu banco</p>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                </div>

                <div id="csvPreviewSection" style="display: none;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">Correspondência de Colunas</h3>
                    <p style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 1rem;">Indique qual coluna do seu arquivo corresponde a cada dado.</p>
                    
                    <div class="mapping-grid">
                        <div class="form-group">
                            <label class="form-label">Coluna Data</label>
                            <select id="mapDateCol" class="form-select"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coluna Descrição</label>
                            <select id="mapDescCol" class="form-select"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coluna Valor</label>
                            <select id="mapAmountCol" class="form-select"></select>
                        </div>
                    </div>

                    <div class="csv-preview-container">
                        <div class="csv-preview-table-wrapper">
                            <table class="csv-preview-table" id="csvPreviewTable">
                                <!-- JS populates this -->
                            </table>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                    <button type="button" id="processCsvBtn" class="btn" disabled>Importar Transações</button>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="editModalTitle" class="modal-title">Editar Transação</h2>
                    <button class="action-btn close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <form id="editForm">
                    <input type="hidden" id="editItemId" name="itemId">
                    <input type="hidden" id="editItemType" name="itemType">
                    
                    <div class="form-group">
                        <label class="form-label" for="editDescription">Descrição</label>
                        <input type="text" id="editDescription" name="description" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAmount">Valor (R$)</label>
                        <input type="text" id="editAmount" name="amount" class="form-input" required inputmode="decimal">
                    </div>
                    
                    <div id="editSourceAccountGroup" class="form-group">
                        <label class="form-label" for="editSourceAccount">Conta de Saída</label>
                        <select id="editSourceAccount" name="sourceAccount" class="form-select"></select>
                    </div>

                    <div id="editCategoryGroup" class="form-group">
                        <label class="form-label" for="editCategory">Categoria</label>
                        <select id="editCategory" name="category" class="form-select"></select>
                    </div>

                    <div id="editDueDateGroup" class="form-group">
                        <label class="form-label" for="editDueDate">Vencimento/Data</label>
                        <input type="date" id="editDueDate" name="dueDate" class="form-input">
                    </div>
                    
                    <div id="editPaidDateGroup" class="form-group" style="display: none;">
                        <label class="form-label" for="editPaidDate">Data do Pagamento</label>
                        <input type="date" id="editPaidDate" name="paidDate" class="form-input">
                    </div>

                    <div id="editInstallmentsGroup" class="form-group" style="display: none;">
                         <label class="form-label">Parcelamento</label>
                         <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" style="font-size: 0.75rem;">Atual</label>
                                <input type="number" id="editCurrentInstallment" name="currentInstallment" class="form-input" min="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label" style="font-size: 0.75rem;">Total</label>
                                <input type="number" id="editTotalInstallments" name="totalInstallments" class="form-input" min="1">
                            </div>
                         </div>
                         <p id="editInstallmentsInfo" style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">Editando uma parcela de uma série.</p>
                    </div>

                    <div class="modal-footer" style="justify-content: space-between;">
                        <button type="button" id="deleteItemBtn" class="btn btn-danger">Excluir</button>
                        <div style="display: flex; gap: 1rem;">
                            <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                            <button type="submit" class="btn">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- AI Modal -->
        <div id="aiModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="aiModalTitle" class="modal-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12c0-1.2-.6-2.4-1.7-3A3.6 3.6 0 0 0 15 8.3c-1.1.5-2 1.4-2 2.7s.9 2.2 2 2.7c.4.1.8.2 1.3.3 1.1.6 2.3 0-3.1-1 .2-.3.3-.6-.3-1z"></path></svg>
                        Análise Inteligente
                    </h2>
                    <button class="action-btn close-modal-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div id="aiAnalysis">
                    <!-- Chat messages will appear here -->
                </div>
                <div class="ai-footer">
                    <form id="aiChatForm">
                        <input type="text" id="aiChatInput" class="form-input" placeholder="Pergunte sobre suas finanças..." autocomplete="off">
                        <button type="submit" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Goal Modal -->
        <div id="goalModal" class="modal">
             <div class="modal-content">
                 <div class="modal-header">
                     <h2 id="goalModalTitle" class="modal-title">Nova Meta de Gastos</h2>
                     <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                 </div>
                 <form id="goalForm">
                     <input type="hidden" id="goalId" name="goalId">
                     <div class="form-group">
                         <label class="form-label" for="goalCategory">Categoria</label>
                         <select id="goalCategory" name="goalCategory" class="form-select" required></select>
                     </div>
                     <div class="form-group">
                         <label class="form-label" for="goalAmount">Limite Mensal (R$)</label>
                         <input type="text" id="goalAmount" name="goalAmount" class="form-input" required inputmode="decimal">
                     </div>
                     <div class="modal-footer">
                         <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                         <button type="submit" class="btn">Salvar Meta</button>
                     </div>
                 </form>
             </div>
        </div>

        <!-- Account Modal -->
        <div id="accountModal" class="modal">
             <div class="modal-content">
                 <div class="modal-header">
                     <h2 id="accountModalTitle" class="modal-title">Conta Bancária</h2>
                     <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                 </div>
                 <form id="accountForm">
                     <input type="hidden" id="accountId" name="accountId">
                     <div class="form-group">
                         <label class="form-label" for="accountName">Nome da Conta</label>
                         <input type="text" id="accountName" name="accountName" class="form-input" required placeholder="Ex: Nubank, Carteira">
                     </div>
                     <div class="form-group">
                         <label class="form-label" for="accountBalance">Saldo Inicial (R$)</label>
                         <input type="text" id="accountBalance" name="accountBalance" class="form-input" required inputmode="decimal">
                     </div>
                     <div class="modal-footer">
                         <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                         <button type="submit" class="btn">Salvar</button>
                     </div>
                 </form>
             </div>
        </div>

        <!-- Savings Goal Modal -->
        <div id="savingsGoalModal" class="modal">
             <div class="modal-content">
                 <div class="modal-header">
                     <h2 id="savingsGoalModalTitle" class="modal-title">Meta de Poupança</h2>
                     <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                 </div>
                 <form id="savingsGoalForm">
                     <input type="hidden" id="savingsGoalId" name="savingsGoalId">
                     <div class="form-group">
                         <label class="form-label" for="savingsGoalDescription">Objetivo</label>
                         <input type="text" id="savingsGoalDescription" name="savingsGoalDescription" class="form-input" required placeholder="Ex: Viagem 2025">
                     </div>
                     <div class="form-row">
                         <div class="form-group">
                             <label class="form-label" for="savingsGoalCurrent">Guardado (R$)</label>
                             <input type="text" id="savingsGoalCurrent" name="savingsGoalCurrent" class="form-input" required inputmode="decimal">
                         </div>
                         <div class="form-group">
                             <label class="form-label" for="savingsGoalTarget">Meta (R$)</label>
                             <input type="text" id="savingsGoalTarget" name="savingsGoalTarget" class="form-input" required inputmode="decimal">
                         </div>
                     </div>
                     <div class="modal-footer">
                         <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                         <button type="submit" class="btn">Salvar</button>
                     </div>
                 </form>
             </div>
        </div>

        <!-- TAB BAR -->
        <nav id="tab-bar">
            <button class="tab-btn active" data-view="home">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Início
            </button>
            <button class="tab-btn" data-view="lancamentos">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                Lançamentos
            </button>
            <button class="tab-btn" data-view="goals">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                Metas
            </button>
        </nav>
        
    </div>
    
    <script type="module" src="index.tsx"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed:', registrationError);
                    });
            });
        }
    </script>
</body>
</html>